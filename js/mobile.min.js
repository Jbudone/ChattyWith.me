var _body,_logo,startLoading,finishLoading,pre_setup,setupPage,JQueryMobWrap,MobDevice,chanSlider;_body=null,_logo=null,startLoading=function(){_body.style.display="none"},finishLoading=function(){_logo&&(_logo.style.display="none"),_body.style.display=""},_body=MOBILE_LOADING?document.getElementsByTagName("innerBody")[0]:document.body,_logo=MOBILE_LOADING?document.getElementById("top-logo"):null,function(e){var n=!0,t="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js",i="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js",o="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css",s="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css";e.use_unstable_jquery=n,e.jquery_mob_src=n==1?i:t,e.jquery_mob_css=n==1?s:o,e.jquery_mob_src="js/jquery.mobile-1.2.0.js"}(settings),pre_setup=function(){},Message.prototype.getClassesFromType=function(e){var n={user:[],time:[],message:[],container:[]};return e.match(/error/)?n.message=["message-error"]:e.match(/success/)?n.container=n.message=["message-success","ui-link"]:e.match(/action/)?n.container=n.message=n.user=["message-action"]:e.match(/message/)?n.container=["ui-link"]:e.match(/whisper/)||e.match(/event/)&&(n.container=["ui-link"],n.time=["hidden"]),e.match(/self/)&&(n.container=n.user=["message-self","bold"]),e.match(/old/)&&(n.container=["message-old"]),n},Terminal.scrollToBottom=function(){var e=250,n=0,t=0,i=function(i){(i||window.pageYOffset+e>=document.body.scrollHeight-window.innerHeight)&&setTimeout(function(){window.scrollTo(0,document.body.scrollHeight+t)},n)};return i}(),Terminal.resizePage=function(){var e=$("#console").outerHeight(!1)-$("#console").outerHeight(!0)-8;$("#console").css({"min-height":window.innerHeight-$("#fPrompt").height()-$("header").height()+e})},settings.hideBodyOnMessage?(Terminal.hideBody=function(){return _console=document.getElementById("console"),_hide=function(){_console.style.display="none"}}(),Terminal.showBody=function(){return _console=document.getElementById("console"),_show=function(){_console.style.display=""}}()):(Terminal.hideBody=function(){},Terminal.showBody=function(){}),Terminal.removeChannelWin=function(e){},Terminal.removeChannelWins=function(e){},Terminal.hk_swapChannel_post=function(){setTimeout(function(){try{Terminal._headerFix.refresh()}catch(e){}},1500)},client.hk_initialize_post=function(){pre_setup(),JQueryMobWrap.showPageLoadingMsg(),setupPage(),Terminal.swapChannel(0),Terminal.print_preset("loaded_mobile"),(new Event).fromObject({eventid:ECMD_STATUS}).request(function(e){return e.identification?(client.usrNick=e.nick,client.usrIdentification=e.identification,client.usrid=e.userid,Terminal.print_preset("logon_mobile"),Terminal.scrollToBottom(!0),client.initialReconnect=!0,client.longpoll()):localStorage&&localStorage.getItem("identification")?(new Event).fromObject({eventid:ECMD_IDENTIFY,id:localStorage.getItem("identification")}).request(function(e){client.usrNick=e.nick,client.usrIdentification=e.identification,client.usrid=e.userid,Terminal.print_preset("logon_mobile"),Terminal.scrollToBottom(!0),client.initialReconnect=!0,client.longpoll()}):Terminal.print_preset("loaded_loggedout_mobile"),!1}),setTimeout(finishLoading,200)},setupPage=function(){var n,t,i,o,s,a,r;n=function(){Events.Event[ECMD_LOGIN].hooks.reqSuccess=Events.Event[ECMD_IDENTIFY].hooks.reqSuccess=function(e){Terminal.print_preset("logon_mobile"),Terminal.scrollToBottom(!0)},Events.Event[ECMD_LOGIN].hooks.reqSuccessError=Events.Event[ECMD_IDENTIFY].hooks.reqSuccessError=function(e,n){},Events.Event[ECMD_LOGOUT].hooks.reqSuccess=function(e,n){},Events.Event[ECMD_STATUS].hooks.reqSuccess=function(e,n){},Events.Event[ECMD_LEAVE].hooks.reqSuccess=function(e,n){for(chanid in client.channels)if(chanid!=0)return;try{JQueryMobWrap.disable($("#chanPrev")),JQueryMobWrap.disable($("#chanNext")),JQueryMobWrap.disable($("#chanHome"))}catch(t){}},Events.Event[ECMD_JOIN].hooks.reqSuccess=function(e,n){try{JQueryMobWrap.enable($("#chanPrev")),JQueryMobWrap.enable($("#chanNext")),JQueryMobWrap.enable($("#chanHome"))}catch(t){}},Events.Event[ECMD_MESSAGE].hooks.reqSuccess=function(e,n){},hk_server_event_append_message=function(){Terminal.print_message(this.arguments.chanid,this.arguments,!1,!1)},hk_server_event_prepend_message=function(){Terminal.print_message(this.arguments.chanid,this.arguments,!0,!1)},hk_server_event_append_whisper=function(){Terminal.print_message(null,this.arguments,!1,!1)},hk_server_event_append_log=function(e,n){Terminal.print(client.activeChanRef.chanid,n.message,n.type),Terminal.scrollToBottom(!0)},hk_server_event_add_messages_completed=function(){Terminal.scrollToBottom()},hk_server_event_from_undefined_event=function(){},hk_event_request_from_undefined_event=function(){Terminal.print(client.activeChanRef.chanid,"We're not exactly sure what you're trying to do.. ^o)","error"),Terminal.scrollToBottom()},hk_server_event_exception_thrown=function(n,t){Terminal.print(client.activeChanRef.chanid,"exception thrown: "+t.message,"error"),Terminal.scrollToBottom()},hk_event_request_exception_thrown=function(n,t){Terminal.print(client.activeChanRef.chanid,"exception thrown: "+t.message,"error"),Terminal.scrollToBottom()},hk_event_parsed_bad_format=function(){Terminal.print(client.activeChanRef.chanid,"Error parsing command: "+this.evtref.help,"error"),Terminal.scrollToBottom()},hk_event_unknown_command=function(e,n){Terminal.print(client.activeChanRef.chanid,"Unknown command (^15"+n+"^1).. ^o)","error"),Terminal.scrollToBottom()},hk_server_response_error=function(e,n){},client.hk_messagesreceived_post=function(){Terminal.scrollToBottom()},client.hk_longpoll_post=function(){}},t=function(){},i=function(){var e,n,t,i,o,s;e=document.createDocumentFragment(),n=document.createElement("meta"),n.setAttribute("name","apple-mobile-web-app-status-bar-style"),n.setAttribute("content","red"),e.appendChild(n),t=document.createElement("meta"),t.setAttribute("name","apple-mobile-web-app-capable"),t.setAttribute("content","yes"),e.appendChild(t),i=document.createElement("link"),i.setAttribute("rel","apple-touch-startup-image"),i.setAttribute("href","/images/ruby.png"),e.appendChild(i),o=document.createElement("link"),o.setAttribute("rel","stylesheet"),o.setAttribute("href",settings.jquery_mob_css),e.appendChild(o),s=document.createElement("script"),s.type="text/javascript",s.src=settings.jquery_mob_src,s.onload=function(){r()},e.appendChild(s),document.getElementsByTagName("head").item(0).appendChild(e)},o=function(){Terminal._headerFix=function(){var e={refresh:null},n=document.getElementById("header"),t=0;return e.refresh=function(){n.style.top=window.scrollY+t+"px !important"},$(document).bind("scroll scrollstop",function(){if(Terminal._disconnected!=1){if(0>=window.scrollY&&client.activeChanRef.chanid!=0){JQueryMobWrap.showPageLoadingMsg();var n=document.body.scrollHeight,t=null;_hk_add_messages=hk_server_event_add_messages_completed,_hk_add_messages_pre=hk_server_event_add_messages_started,hk_server_event_add_messages_completed=null,hk_server_event_add_messages_started=function(){t=window.scrollY},Terminal.loadOlder.load(function(){setTimeout(function(){JQueryMobWrap.hidePageLoadingMsg(),window.scrollTo(0,document.body.scrollHeight-n-100+t),e.refresh()},150),hk_server_event_add_messages_completed=_hk_add_messages,hk_server_event_add_messages_started=_hk_add_messages_pre})}e.refresh()}}),e}(),function(){var e,n,t,i,o,s,a,r;return settings.pingEnabled?(e=0,n=settings.minPingTimeoutsToDisconnect,t=null,i=null,o=function(){},s=function(){},a=Events.Event.ECMD_LOGIN.hooks.reqSuccess,Events.Event.ECMD_LOGIN.hooks.reqSuccess=function(e){a(e),t=(new Date).getTime()},a=Events.Event.ECMD_JOIN.hooks.reqSuccess,Events.Event.ECMD_JOIN.hooks.reqSuccess=function(e){a(e);var n=getChanCount();n==2&&(t=(new Date).getTime())},o=function(){(new Event).fromObject({eventid:ECMD_LOGOUT}).request(),i=null},s=function(){var e,n;if(client.usrid==null||Terminal._disconnected||i==null||getChanCount()<2){e=i,i=null;for(n in client.channels)if(n!=null){i=e;break}}else(new Date).getTime()-i>settings.maxTimeSinceLastPingToDisconnect&&t!=null&&(new Date).getTime()-t>settings.maxTimeSinceLastPingToDisconnect&&(window.console.log("D/C!  time:"+(new Date).getTime()+"-"+i+">"+settings.maxTimeSinceLastPingToDisconnect),o());setTimeout(s,settings.checkIfActiveTimer)},s(),pingSuccess=function(n){Terminal._disconnected==1&&(Terminal._disconnected=!1,$("body").removeClass("disconnected"),$("#prompt").attr({disabled:!1}),JQueryMobWrap.hidePageLoadingMsg()),e=0},pingFail=function(){e++,n>e||(Terminal._disconnected=!0,$("body").addClass("disconnected"),JQueryMobWrap.showPageLoadingMsg())},settings.useLongpollPing?(client.hk_longpoll_success=function(e){var n=e.timeReceived-r;pingSuccess(parseInt(n))},client.hk_longpoll_error=function(e){pingFail()},client.hk_longpoll_post=function(){r=Date.now()+"",r=r.substr(0,r.length-3)+"."+r.substr(r.length-3),r=parseFloat(r),i=(new Date).getTime()}):(Events.Event[ECMD_PINGCHAN].hooks.reqSuccess=function(e,n){pingSuccess(n),i=(new Date).getTime()},Events.Event[ECMD_PINGCHAN].hooks.reqSuccessError=function(e,n){pingFail(),i=(new Date).getTime()}),void 0):!1}(),window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,1)},0)})},s=function(){var e,n;document.getElementById("main").setAttribute("data-role","page"),document.getElementById("console").setAttribute("data-role","content"),e=document.getElementById("footer"),e.setAttribute("data-role","footer"),e.setAttribute("class","ui-footer"),e.className="ui-bar",n=document.getElementById("prompt"),n.setAttribute("autocorrect","on"),n.setAttribute("autocomplete","on"),n.setAttribute("autocapitalize","sentences"),n.setAttribute("data-mini","true"),n.style.width="100%"},a=function(){$("#fPrompt").submit(function(){var e,n,t,i;return e=new Date,client._tMessageCreated=e.getTime(),n=$("#prompt").val(),$("#prompt").val(""),t=new Event,i=t.parse(n),i&&i.request(),!1});var e=settings.message_maxlen;$("#prompt").keyup(function(){var n=$("#prompt").val(),t=n.replace(/(\\|'|")/g,function(e){return"\\"+e});t.length>e?$(this).val($(this).attr("safeguard")):$(this).attr("safeguard",n)})},r=function(){setTimeout(function(){Terminal.resizePage()},1e3),$(document).bind("tap",function(){Terminal._disconnected!=1&&JQueryMobWrap.toggleToolbars()}),JQueryMobWrap.hidePageLoadingMsg()},n(),t(),i(),o(),s(),a()},JQueryMobWrap=function(){var e={enable:null,disable:null,showPageLoadingMsg:null,hidePageLoadingMsg:null,showToolbars:null,hideToolbars:null,triggerToolbars:null};return function(){e.enable=function(e){e.attr("disabled",!1).removeClass("ui-disabled").attr("aria-disabled",!1)},e.disable=function(e){e.attr("disabled",!0).addClass("ui-disabled").attr("aria-disabled",!0)},e.showPageLoadingMsg=function(e,n,t){$("body").addClass("ui-loading")},e.hidePageLoadingMsg=function(){$("body").removeClass("ui-loading")},e.showToolbars=function(){},e.hideToolbars=function(){},e.toggleToolbars=function(){return}}(),e}(),MobDevice=function(){var e={device:"",keyboardInFocus:!1,orientation:"portrait",keyboard_height:0};return function(){var n,t,i,o;n=0,t=1,i=[],i[n]={portrait:216,landscape:162},i[t]={portrait:264,landscape:352},o=236,navigator.userAgent.match(/(phone|mobile|pod|android)/)||480>=screen.width&&800>=screen.height?(e.device="iphone",i=i[n]):(e.device="ipad",i=i[t]),$("#prompt").bind("focus",function(){e.keyboardInFocus=!0,e.keyboard_height=i[e.orientation]}),$("#prompt").bind("blur",function(){e.keyboardInFocus=!1,e.keyboard_height=o})}(),e}(),chanSlider=function(){var e,n,t,o,s,a,r,c,l,d;return e={slideLeft:null,slideRight:null},n={slideTime:1300,bubbleFadeTime:400,chanNameTimeToComeIn:600,chanNameFadeTime:400,animateSlider:!0,testMode:!1},t=!1,o=null,o=$("<div/>").addClass("chan-bubbles").appendTo("body"),s=$("<div/>").addClass("chan-name").appendTo("body"),a=function(){o.html("");for(var e in client.channels)$("<div/>").addClass("chan-bubble").attr("chanid",e).appendTo(o)},r=function(e){var n,t,o;for(n=$("<div/>").addClass("console-clone").attr("id","console-clone"),t=$("#console .chanitem.chanid-"+e).slice(-30),o=0;t.length>o;o++)$(n).append($(t[o]).clone(!1));return n},c=function(e){var n=Math.min($("#console").width(),$(window).width()),t=$("#console").height(),i=r(e);return $("#console").addClass("console-sliding").css({width:n,height:t}),$(i).css({width:n,height:t,"margin-left":0}).insertBefore("#console"),$("#main").addClass("console-parent-slidemode"),i},l=function(e){var n=Math.min($("#console").width(),$(window).width()),t=$("#console").height(),i=r(e);return $("#console").addClass("console-sliding").css({width:n,height:t}),$(i).css({width:n,height:t}).insertAfter("#console"),$("#main").addClass("console-parent-slidemode"),i},d=function(e){if(t)return!1;if(t=!0,chanid=client._prevChanid,n.animateSlider){a();var i=(e?c(chanid):l(chanid)).addClass("console-anim-slider"),r=$("#console"),d=r.width(),u=$('[chanid="'+chanid+'"]',o).addClass("selected");if(e||$(r).css({"margin-left":-d}),n.testMode)return window.clone=i,window.cons=r,window.width=d,void 0;setTimeout(function(){e||$(r).addClass("console-anim-slider"),o.removeClass("hidden");var a=e?i:r;$(a).css({"margin-left":e?-d:0}),setTimeout(function(){s.text(client.activeChanRef.channame).removeClass("hidden")},n.chanNameTimeToComeIn),setTimeout(function(){i.remove(),$("#console").removeClass("console-sliding").removeClass("console-anim-slider").css({width:"",height:""}),$("#main").removeClass("console-parent-slidemode"),o.animate({opacity:0},n.bubbleFadeTime,function(){o.addClass("hidden").css({opacity:""})}),s.animate({opacity:0},n.chanNameFadeTime,function(){s.addClass("hidden").css({opacity:""})}),u.removeClass("selected"),$('[chanid="'+chanid+'"]',o).addClass("selected"),t=!1},n.slideTime)},0)}else $('[chanid="'+chanid+'"]',o).addClass("selected"),o.removeClass("hidden"),o.animate({opacity:0},n.bubbleFadeTime,function(){o.addClass("hidden").css({opacity:""})}),s.animate({opacity:0},n.chanNameFadeTime,function(){s.addClass("hidden").css({opacity:""})}),t=!1},e.slideLeft=function(){d(!0)},e.slideRight=function(){d(!1)},$(document).bind("pageinit",function(){$("#console").bind("swipeleft",function(e){Terminal.swapChannel(getChanIDFromOffset(1),!0)}),$("#console").bind("swiperight",function(e){Terminal.swapChannel(getChanIDFromOffset(-1),!1)}),setTimeout(function(){Terminal.hk_swapChannel_pre=function(e,n){e=client._prevChanid,console.log("switching from channel: "+e);try{n?chanSlider.slideLeft():chanSlider.slideRight()}catch(t){}}},2500)}),e}(),client.initialize()